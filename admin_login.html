<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Barangay LIAS • Admin Login</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"/>

  <style>
    .card-shadow { box-shadow: 0 16px 40px rgba(0,0,0,.12); }
  </style>
</head>
<body class="min-h-screen bg-gray-100 text-gray-800">

  <!-- Make left side a bit wider and allow overlap -->
  <main class="min-h-screen grid lg:grid-cols-[70%_30%] relative">
    <!-- LEFT: hero -->
    <section class="relative hidden lg:block z-0">
      <img src="/images/admin_bg.jpg" class="absolute inset-0 w-full h-full object-cover" alt="">
      <div class="absolute inset-0 bg-green-900/40"></div>

      <div class="relative h-full flex flex-col justify-end p-10 text-white">
        <img src="/images/barangay_logo.jpg" alt="Barangay Logo" class="w-20 h-20 rounded-full mb-4">
        <h1 class="text-4xl font-extrabold">Barangay LIAS</h1>
        <p class="mt-6 max-w-xl text-white/90">
          Login to Barangay LIAS Portal.
        </p>
        <p class="mt-10 text-sm text-white/70">&copy; <span id="year"></span> Barangay LIAS</p>
      </div>
    </section>

    <!-- RIGHT: login card (overlaps the image) -->
    <section class="flex items-center justify-center p-6 lg:p-12 relative overflow-visible">
      <!-- Pull the card left and keep it above the image -->
      <div class="w-full max-w-md bg-white rounded-xl shadow-2xl p-8 relative z-10 lg:-ml-80">
        <div class="mb-6 text-center">
          <div class="inline-flex items-center gap-2">
            <i class="bi bi-shield-lock text-green-600 text-2xl"></i>
            <h2 class="text-2xl font-bold text-green-700">Account Login</h2>
          </div>
        </div>

        <!-- Alert -->
        <div id="alert" class="hidden mb-4 rounded-md border px-3 py-2 text-sm"></div>

        <form id="loginForm" class="space-y-4">
          <div>
            <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
            <input id="username" type="text" required
                   class="w-full rounded-md border-gray-300 focus:border-green-600 focus:ring-green-600 px-3 py-2"
                   placeholder="Enter your username">
          </div>
          <div>
            <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
            <input id="password" type="password" required minlength="4"
                   class="w-full rounded-md border-gray-300 focus:border-green-600 focus:ring-green-600 px-3 py-2"
                   placeholder="•••••">
          </div>

          <button id="submitBtn" type="submit"
                  class="w-full bg-green-600 hover:bg-green-700 text-white rounded-md py-2.5 font-semibold flex items-center justify-center gap-2">
            <i class="bi bi-box-arrow-in-right"></i>
            <span>Sign In</span>
            <span id="spinner" class="hidden animate-spin border-2 border-white/60 border-t-transparent rounded-full w-4 h-4"></span>
          </button>
        </form>

        <p class="mt-6 text-center text-xs text-gray-500">
          Access for registered users and administrators.
        </p>
      </div>
    </section>
  </main>

  <!-- Supabase (ESM) -->
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js"

    // 🔐 Replace with your project details
    const SUPABASE_URL = "https://fkvsynlnlmukgfjffkvp.supabase.co"
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZrdnN5bmxubG11a2dmamZma3ZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njc4NDUsImV4cCI6MjA3MTQ0Mzg0NX0.366rjmJhIHdxC3Z4ZqNfJMUHuUw-WHCiHaGKXh1PTtI"
    const REDIRECT_AFTER_LOGIN = "index.html"

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

    const year = document.getElementById("year")
    year.textContent = new Date().getFullYear()

    const form = document.getElementById("loginForm")
    const username = document.getElementById("username")
    const password = document.getElementById("password")
    const alertBox = document.getElementById("alert")
    const submitBtn = document.getElementById("submitBtn")
    const spinner = document.getElementById("spinner")

    function showAlert(msg, kind="info") {
      const styles = {
        info: "border-blue-200 bg-blue-50 text-blue-700",
        error:"border-red-200 bg-red-50 text-red-700",
        ok:   "border-emerald-200 bg-emerald-50 text-emerald-700"
      }
      alertBox.className = `mb-4 rounded-md border px-3 py-2 text-sm ${styles[kind]}`
      alertBox.textContent = msg
      alertBox.classList.remove("hidden")
    }
    function setLoading(b) {
      submitBtn.disabled = b
      spinner.classList.toggle("hidden", !b)
      submitBtn.classList.toggle("opacity-60", b)
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault()
      setLoading(true)
      showAlert("Checking credentials…", "info")
      try {
        // 🔎 Look up the username + password in your "admin_users" table
        const { data, error } = await supabase
          .from("admin")
          .select("id, username, password")
          .eq("username", username.value.trim())
          .eq("password", password.value) // ⚠️ hash passwords in real apps
          .single()

        if (error || !data) throw new Error("Invalid username or password")

        showAlert("Welcome Admin! Redirecting…", "ok")
        setTimeout(() => window.location.href = REDIRECT_AFTER_LOGIN, 600)
      } catch (err) {
        showAlert(err.message || "Login failed.", "error")
      } finally {
        setLoading(false)
      }
    })
  </script>
</body>
</html>
